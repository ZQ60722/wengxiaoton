<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€ç»™ç¿åŒå­¦çš„</title>
    <script src="js/Star.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(to bottom, #0a0e27 0%, #1a237e 50%, #283593 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        /* æ˜Ÿç©ºèƒŒæ™¯ */
        .stars-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        /* åˆ›å»ºåŠé€æ˜å›¾ç‰‡èƒŒæ™¯å±‚ */
        .stars-background::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60vw;
            aspect-ratio: 16/9;
            background: url('img+audio/song.jpg') center/cover;
            opacity: 0.6;
            z-index: 1;
            backdrop-filter: blur(15px);
            mask: radial-gradient(ellipse at center,
            rgba(0,0,0,1) 0%,      /* ä¸­å¿ƒå®Œå…¨ä¸é€æ˜ */
            rgba(0,0,0,1) 30%,     /* 30%èŒƒå›´å†…ä¿æŒæ¸…æ™° */
            rgba(0,0,0,0.8) 50%,   /* å¼€å§‹æ¸å˜é€æ˜ */
            rgba(0,0,0,0.3) 80%,   /* ç»§ç»­æ¸å˜ */
            rgba(0,0,0,0) 100%);   /* è¾¹ç¼˜å®Œå…¨é€æ˜ */
            -webkit-mask: radial-gradient(ellipse at center,
            rgba(0,0,0,1) 0%,
            rgba(0,0,0,1) 30%,
            rgba(0,0,0,0.8) 50%,
            rgba(0,0,0,0.3) 80%,
            rgba(0,0,0,0) 100%);
            border-radius: 20px;
        }



        .star {
            z-index: 1;
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        /* æµæ˜Ÿæ•ˆæœ */
        .meteor {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
        }

        .meteor-body {
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
        }

        .meteor-tail {
            position: absolute;
            top: 0;
            left: 0;
            width: 150px;
            height: 2px;
            background: linear-gradient(to left, transparent, rgba(255, 255, 255, 0.8));
            transform-origin: right center;
        }
        /* è¡¨æƒ…æµæ˜Ÿ */
        .emoji-meteor {
            position: fixed;
            font-size: 1.5rem;
            z-index: 9999;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            animation: meteorFall linear;
        }

        @keyframes meteorFall {
            0% {
                opacity: 0;
                transform: translate(0, 0) rotate(0deg);
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translate(var(--end-x), var(--end-y)) rotate(var(--rotation));
            }
        }
        .main-container {
            text-align: center;
            z-index: 10;
            position: relative;
        }

        .message-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .message-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.4);
        }

        .message-btn:active {
            transform: translateY(-1px);
        }

        /* å¼¹çª—æ ·å¼ */
        .blessing-popup {
            position: fixed;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            max-width: 300px;
            z-index: 1000;
            animation: popupAppear 0.5s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes popupAppear {
            0% {
                transform: scale(0) rotate(-10deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.1) rotate(5deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .popup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
        }

        .popup-header .icon {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .popup-close {
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .popup-close:hover {
            opacity: 1;
        }

        .popup-content {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 20px;
            border-radius: 0 0 12px 12px;
            text-align: center;
            font-size: 16px;
            color: #2d3436;
            font-weight: 500;
            line-height: 1.5;
        }

        .popup-emoji {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }
        /* æµ®åŠ¨çƒæŒ‰é’®æ ·å¼ */
        .floating-ball {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 1002;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .floating-ball:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }

        .floating-ball.active {
            animation: none;
            transform: scale(0.9);
            opacity: 0.8;
        }

        .ball-icon {
            color: white;
            font-size: 24px;
            transition: transform 0.3s ease;
        }

        .floating-ball.active .ball-icon {
            transform: rotate(45deg);
        }

        /* æ§åˆ¶é¢æ¿æ ·å¼ */
        .control-panel {
            position: fixed;
            top: 90px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            max-width: 300px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .control-panel.active {
            max-height: 500px;
            opacity: 1;
            transform: translateY(0);
            overflow: visible;
        }
        .control-panel h3 {
            margin-bottom: 15px;
            color: #2d3436;
        }

        .blessing-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .blessing-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-blessing-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }

        .add-blessing-btn:hover {
            transform: translateY(-2px);
        }

        .blessing-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
        }

        .blessing-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .blessing-item:last-child {
            border-bottom: none;
        }

        .delete-blessing {
            color: #ff6b6b;
            cursor: pointer;
            font-size: 18px;
        }

        .clear-all-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
            margin-top: 10px;
        }
        /* é¢æ¿è®¡æ•°å™¨ */
        .panel-counter {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .control-panel {
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .floating-ball {
                right: 10px;
                top: 10px;
            }
        }
    </style>
</head>
<body>
<div class="stars-background" id="starsBackground"></div>

<div class="main-container">
    <button class="message-btn" onclick="handleMessageClick()">
        âœ¨ å…ƒæ—¦å¿«ä¹ âœ¨
    </button>
</div>
<!-- æµ®åŠ¨çƒæŒ‰é’® -->
<div class="floating-ball" id="floatingBall" onclick="toggleControlPanel()">
    <span class="ball-icon">+</span>
    <div class="panel-counter" id="panelCounter">0</div>
</div>
<!-- æ§åˆ¶é¢æ¿ -->
<div class="control-panel" id="controlPanel">
    <h3>ğŸ‰ ç¥ç¦è¯­ç®¡ç†</h3>
    <input type="text" class="blessing-input" id="blessingInput" placeholder="è¾“å…¥è‡ªå®šä¹‰ç¥ç¦è¯­...">
    <button class="add-blessing-btn" onclick="addCustomBlessing()">æ·»åŠ ç¥ç¦è¯­</button>
    <div class="blessing-list" id="blessingList"></div>
    <button class="clear-all-btn" onclick="clearAllBlessings()">æ¸…ç©ºæ‰€æœ‰å¼¹çª—</button>
</div>
<!-- åœ¨ body çš„æœ€åä½ç½®æ·»åŠ  -->
<audio id="backgroundMusic" src="img+audio/æ¶ä½œå‰§.mp3" loop style="display: none;"></audio>

<script>
    // é»˜è®¤ç¥ç¦è¯­åˆ—è¡¨
    let defaultBlessings = [
        { text: "ç¥è¿™ä½ä¼˜ç§€çš„å¥³å­©å…ƒæ—¦å¿«ä¹ï¼Œæ›´é«˜å¤„è§ï¼", emoji: "ğŸ‰ï¸" },
        { text: "çª—å°è´è¶åƒè¯—é‡Œçº·é£çš„ç¾ä¸½ç« èŠ‚   â€”â€”ã€Šä¸ƒé‡Œé¦™ã€‹", emoji: "ğŸ¦‹" },
        { text: "çº¸ä¸Šçš„å½©è™¹ï¼Œç”¨ç´ æç”»çš„é’Ÿï¼Œæˆ‘è¿˜åœ¨ä¿®æ”¹å›å¿†ä¹‹ä¸­ä½ çš„ç¬‘å®¹ï¸â€”â€”ã€Šæ‰‹å†™çš„ä»å‰ã€‹", emoji: "ğŸŒˆ" },
        { text: "ç¥ç€è‰²é»„æ˜åƒç³–åœ¨å¾ˆç¾çš„è¿œæ–¹ï¼ â€”â€”ã€Šå›­æ¸¸ä¼šã€‹ğŸŒŸ", emoji: "ğŸˆ" },
        { text: "ä¸è¦å“­è®©è¤ç«è™«å¸¦ç€ä½ é€ƒè·‘ï¼Œä¹¡é—´çš„æ­Œè°£æ°¸è¿œçš„ä¾é ğŸµ    â€”â€”ã€Šç¨»é¦™ã€‹", emoji: "ğŸŒ¸" },
        { text: "é™¨çŸ³åœ¨æµ©ç€šçš„å®‡å®™é—´æ—…è¡Œï¼Œç’€ç’¨çš„å¤œç©ºé‡Œæ¼«å¤©çš„æ°´æ™¶  â€”â€”ã€Šæˆ‘æ˜¯å¦‚æ­¤ç›¸ä¿¡ã€‹", emoji: "ğŸ¸" },
        { text: "é¡ºé‚æ— è™ï¼Œçš†å¾—æ‰€æ„¿  â€”â€”ã€Šå¤§å­¦ã€‹", emoji: "ğŸ¯" },
        { text: "åˆä½œçš„æ—¶é—´å¾ˆçŸ­ï¼Œä¸è¿‡å¯ä»¥æ„Ÿè§‰åˆ°ä½ å¾ˆåŠªåŠ›ï¼Œèƒ½åŠ›å¾ˆå¼ºï¼›è°¢è°¢ä½ å•¦ï¼Œç¥ä½ è¶Šæ¥è¶Šå‰å®³ï¼ŒåŠ æ²¹", emoji: "âœŒ" },
        { text: "é›¨åæ±Ÿå²¸å¤©ç ´æ™“ï¼Œè€èˆŸæ–°å®¢çŸ¥å¤šå°‘ï¼Œè¿œå±±è§ç«¹æ—èŠ³è‰ï¼Œæ™¨é£æŠšç»¿äº†èŠ­è•‰", emoji: "ğŸ" },
        { text: "çº¢é›¨ç“¢æ³¼æ³›èµ·äº†å›å¿†æ€ä¹ˆæ½œï¼Œä½ ç¾ç›®å¦‚å½“å¹´ï¼Œæµè½¬æˆ‘å¿ƒé—´   â€”â€”ã€Šå¦‚æœå½“æ—¶ã€‹", emoji: "âœ‰ï¸" },
        { text: "å¯æ—æå¤´èŠ±æµ·ï¼Œè‹¥æ–°é›ªåˆéœï¼›å†¬æ—¥è½½é˜³ï¼Œç¥é¡ºé‚å¼€å¿ƒ", emoji: "ğŸŒ¤ï¸" },
        { text: "å²æœˆèµ°èµ°åœåœï¼Œæ²¡å†™å‡ºæ¸¸è®°ï¼Œå´æŠŠé£æœˆç§ä¸€è·¯èŠ™è•– â€”â€”ã€Šæµå…‰è®°ã€‹", emoji: "ğŸ’Œ" },
        { text: "ä¸‰æœˆä¸€è·¯çƒŸéœèºé£è‰é•¿ï¼ŒæŸ³çµ®çº·é£é‡Œçœ‹è§äº†æ•…ä¹¡  â€”â€”ã€Šåºå·æœˆã€‹", emoji: "ğŸƒ" },
        { text: "å½“æµ·é¢è¿æ¥æ±¹æ¶Œçš„æ½®æ±ï¼Œæˆ‘å¥”è·‘å¯»æ‰¾æ˜”æ—¥çš„è¶³è¿¹   â€”â€”ã€Šæ½®æ±ã€‹", emoji: "ğŸš‡" },
        { text: "é£æ¸©æŸ”çš„æ¸…æ™°ï¼Œä¹Ÿè®¸ä¼šé£˜æ¥å¥½æ¶ˆæ¯   â€”â€”ã€Šæ¶ä½œå‰§ã€‹", emoji: "âœ‰ï¸" },
        { text: "æ˜¥é£ç»†é›¨ æ·‹æ¹¿è°çš„è®°å¿†ï¼›æœˆå…‰æ•£è½ é’æ¶©è¢«é£å¹èµ·    â€”â€”ã€Šæ˜¥é£è°£ã€‹", emoji: "ğŸŒ " },
        { text: "æ•…äº‹çš„å°é»„èŠ±ï¼Œä»å‡ºç”Ÿé‚£å¹´å°±é£˜ç€   â€”â€”ã€Šæ™´å¤©ã€‹", emoji: "ğŸŒ»" },
        { text: "è½»æŒ¼è‰è‰²äºŒä¸‰å…¥å·ï¼Œç»†å‘·æ˜¥é…’æ·¡å§‹è§‰ç”œ  â€”â€”ã€Šæ£ æ¢¨ç…é›ªã€‹", emoji: "â„" },
        { text: "å¸˜å¤–èŠ­è•‰æƒ¹éª¤é›¨é—¨ç¯æƒ¹é“œç»¿   â€”â€”ã€Šé’èŠ±ç“·ã€‹", emoji: "ğŸŒ§ï¸" },
        { text: "ç–å½±æ¨ªæ–œæ°´æ¸…æµ…ï¼Œæš—é¦™æµ®åŠ¨æœˆé»„æ˜ğŸ’®", emoji: "ğŸŒ™" }
    ];

    // è‡ªå®šä¹‰ç¥ç¦è¯­åˆ—è¡¨
    let customBlessings = [];

    // å¼¹çª—è®¡æ•°å™¨
    let popupCounter = 0;
    let isPanelOpen = false;

    // --- éŸ³ä¹ç›¸å…³å˜é‡ ---
    const musicPlayer = document.getElementById('backgroundMusic');
    let hasMusicStarted = false;

    // å¤„ç†ç•™è¨€æŒ‰é’®ç‚¹å‡»
    function handleMessageClick() {
        console.log("æ‰§è¡ŒåŸæœ‰ç•™è¨€é€»è¾‘...");
        showBlessingPopups();
    }

    // æ˜¾ç¤ºç¥ç¦å¼¹çª—
    function showBlessingPopups() {
        const allBlessings = [...defaultBlessings, ...customBlessings];
        if (allBlessings.length === 0) return;

        const popupCount = Math.floor(Math.random() * 5) + 16; // 16-20ä¸ªå¼¹çª—

        for (let i = 0; i < popupCount; i++) {
            setTimeout(() => {
                const blessing = allBlessings[Math.floor(Math.random() * allBlessings.length)];
                createPopup(blessing);
            }, i * 200);
        }
    }

    // åˆ›å»ºå•ä¸ªå¼¹çª—
    function createPopup(blessing) {
        const popup = document.createElement('div');
        popup.className = 'blessing-popup';
        popup.id = `popup-${popupCounter++}`;

        const maxX = window.innerWidth - 300;
        const maxY = window.innerHeight - 200;
        const randomX = Math.random() * maxX;
        const randomY = Math.random() * maxY;

        popup.style.left = `${randomX}px`;
        popup.style.top = `${randomY}px`;
        popup.style.zIndex = 1000 + Math.floor(Math.random() * 100);

        const colors = [
            'linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%)',
            'linear-gradient(135deg, #fab1a0 0%, #ff7675 100%)',
            'linear-gradient(135deg, #fd79a8 0%, #e84393 100%)',
            'linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%)',
            'linear-gradient(135deg, #55efc4 0%, #00b894 100%)'
        ];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];

        popup.innerHTML = `
            <div class="popup-header">
                <span class="icon">ğŸ’Œ</span>
                <span>é±¼ç„æœºçš„ç¥ç¦</span>
                <span class="popup-close" onclick="closePopup('${popup.id}')">Ã—</span>
            </div>
            <div class="popup-content" style="background: ${randomColor}">
                <span class="popup-emoji">${blessing.emoji}</span>
                ${blessing.text}
            </div>
        `;

        document.body.appendChild(popup);

        setTimeout(() => {
            closePopup(popup.id);
        }, 10000);
    }

    // å…³é—­å¼¹çª—
    function closePopup(popupId) {
        const popup = document.getElementById(popupId);
        if (popup) {
            popup.style.animation = 'popupDisappear 0.3s ease-out';
            setTimeout(() => {
                popup.remove();
            }, 300);
        }
    }

    // --- æ§åˆ¶é¢æ¿ç›¸å…³å‡½æ•° ---
    function toggleControlPanel() {
        const ball = document.getElementById('floatingBall');
        const panel = document.getElementById('controlPanel');
        isPanelOpen = !isPanelOpen;

        if (isPanelOpen) {
            ball.classList.add('active');
            panel.classList.add('active');
        } else {
            ball.classList.remove('active');
            panel.classList.remove('active');
        }
    }

    function updatePanelCounter() {
        const counter = document.getElementById('panelCounter');
        const totalBlessings = defaultBlessings.length + customBlessings.length;
        counter.textContent = totalBlessings;
        counter.style.display = totalBlessings === 0 ? 'none' : 'flex';
    }

    function addCustomBlessing() {
        const input = document.getElementById('blessingInput');
        const text = input.value.trim();

        if (text) {
            const emojis = ['ğŸ’', 'ğŸŒŸ', 'ğŸ‰', 'âœ¨', 'ğŸŒˆ', 'ğŸ’–', 'ğŸŒ¸', 'ğŸ¯'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            customBlessings.push({ text: text, emoji: randomEmoji });
            input.value = '';
            updateBlessingList();
            updatePanelCounter();
            showNotification('ç¥ç¦è¯­æ·»åŠ æˆåŠŸï¼');
        }
    }

    function deleteBlessing(index) {
        customBlessings.splice(index, 1);
        updateBlessingList();
        updatePanelCounter();
    }

    function clearAllBlessings() {
        const popups = document.querySelectorAll('.blessing-popup');
        popups.forEach(popup => {
            popup.style.animation = 'popupDisappear 0.3s ease-out';
            setTimeout(() => popup.remove(), 300);
        });
    }

    function updateBlessingList() {
        const listContainer = document.getElementById('blessingList');
        listContainer.innerHTML = '';
        [...defaultBlessings, ...customBlessings].forEach((blessing, index) => {
            const item = document.createElement('div');
            item.className = 'blessing-item';
            const isCustom = index >= defaultBlessings.length;
            item.innerHTML = `
                <span>${blessing.emoji} ${blessing.text.substring(0, 15)}...</span>
                ${isCustom ? `<span class="delete-blessing" onclick="deleteBlessing(${index - defaultBlessings.length})">Ã—</span>` : ''}
            `;
            listContainer.appendChild(item);
        });
    }

    function showNotification(message) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8); color: white; padding: 12px 24px;
            border-radius: 8px; z-index: 2000; animation: fadeInOut 2s ease;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 2000);
    }

    // --- æ ¸å¿ƒï¼šæ•´åˆçš„å…¨å±€ç‚¹å‡»ç›‘å¬å™¨ ---
    document.addEventListener('click', function(event) {
        // 1. å¤„ç†éŸ³ä¹æ’­æ”¾ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰
        if (!hasMusicStarted && musicPlayer) {
            console.log("æ£€æµ‹åˆ°ç”¨æˆ·é¦–æ¬¡ç‚¹å‡»ï¼Œå¯åŠ¨èƒŒæ™¯éŸ³ä¹...");
            const playPromise = musicPlayer.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    console.log("âœ… èƒŒæ™¯éŸ³ä¹æ’­æ”¾æˆåŠŸï¼");
                }).catch(error => {
                    console.error("âŒ éŸ³ä¹æ’­æ”¾å¤±è´¥:", error);
                });
            }
            hasMusicStarted = true; // æ ‡è®°ä¸ºå·²å¯åŠ¨ï¼Œä¹‹åä¸å†æ‰§è¡Œ
        }

        // 2. å¤„ç†æ§åˆ¶é¢æ¿å…³é—­
        const ball = document.getElementById('floatingBall');
        const panel = document.getElementById('controlPanel');
        if (isPanelOpen && !ball.contains(event.target) && !panel.contains(event.target)) {
            toggleControlPanel();
        }
    }, true); // ä½¿ç”¨æ•è·é˜¶æ®µï¼Œç¡®ä¿éŸ³ä¹ä¼˜å…ˆè§¦å‘

    // --- åˆå§‹åŒ– ---
    function init() {
        updateBlessingList();
        updatePanelCounter();

        // ç›‘å¬å›è½¦é”®æ·»åŠ ç¥ç¦è¯­
        document.getElementById('blessingInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addCustomBlessing();
            }
        });

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes popupDisappear { 0% { transform: scale(1) rotate(0deg); opacity: 1; } 100% { transform: scale(0) rotate(10deg); opacity: 0; } }
            @keyframes fadeInOut { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } 20% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 80% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); } }
        `;
        document.head.appendChild(style);
    }

    // ç¡®ä¿DOMåŠ è½½å®Œæ¯•åå†æ‰§è¡Œåˆå§‹åŒ–
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
</script>
</body>
</html>
